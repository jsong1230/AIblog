{{ define "main" }}
<article class="post">
    <header class="post-header">
        <h1>{{ .Title }}</h1>
        <div class="post-meta">
            <time datetime="{{ .Date.Format "2006-01-02" }}">
                {{ if eq .Language.Lang "en" }}
                    {{ $day := .Date.Day }}
                    {{ $suffix := "th" }}
                    {{ if or (eq $day 1) (eq $day 21) (eq $day 31) }}{{ $suffix = "st" }}{{ else if or (eq $day 2) (eq $day 22) }}{{ $suffix = "nd" }}{{ else if or (eq $day 3) (eq $day 23) }}{{ $suffix = "rd" }}{{ end }}
                    {{ printf "%s %d%s, %d" (.Date.Format "Jan") $day $suffix (.Date.Year) }}
                {{ else }}
                    {{ .Date.Format (i18n "date_format") }}
                {{ end }}
            </time>
            <span class="author">{{ .Params.author | default .Site.Params.author }}</span>
            {{ if .Params.categories }}
            <div class="categories">
                {{ range .Params.categories }}
                <span class="category">{{ . }}</span>
                {{ end }}
            </div>
            {{ end }}
        </div>
        {{ if .Params.image }}
        <img src="{{ .Params.image }}" alt="{{ .Title }}" class="post-image">
        {{ end }}
    </header>
    
    <div class="post-content">
        {{ .Content }}
    </div>
    
    <!-- AdSense -->
    {{ partial "adsense.html" . }}
    
    <!-- Affiliate Links -->
    {{ partial "affiliate.html" . }}
    
    {{ if .Params.tags }}
    <footer class="post-footer">
        <div class="tags">
            {{ range .Params.tags }}
            {{ $tag := . | urlize }}
            {{ $tagPage := $.Site.GetPage (printf "tags/%s" $tag) }}
            {{ if $tagPage }}
            <a href="{{ $tagPage.Permalink }}" class="tag">#{{ . }}</a>
            {{ else }}
            <a href="{{ (printf "tags/%s/" $tag) | absLangURL }}" class="tag">#{{ . }}</a>
            {{ end }}
            {{ end }}
        </div>
    </footer>
    {{ end }}
</article>
{{ end }}

